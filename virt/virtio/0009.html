
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Qemu: Virtio_bus &#8212; GDocs 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Qemu: Virtio_net Device" href="0008.html" />
    <link rel="prev" title="Qemu: Virtio_net_pci" href="0007.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="qemu-virtio-bus">
<span id="virtio-bus"></span><h1><a class="toc-backref" href="#id3" role="doc-backlink">Qemu: Virtio_bus</a><a class="headerlink" href="#qemu-virtio-bus" title="Permalink to this heading">¶</a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#qemu-virtio-bus" id="id3">Qemu: Virtio_bus</a></p>
<ul>
<li><p><a class="reference internal" href="#create-virtio-bus" id="id4">Create Virtio-Bus</a></p></li>
<li><p><a class="reference internal" href="#a-virtiodevice-is-being-plugged" id="id5">A VirtIODevice is being plugged</a></p>
<ul>
<li><p><a class="reference internal" href="#virtio-bus-device-plugged" id="id6">virtio_bus_device_plugged</a></p></li>
<li><p><a class="reference internal" href="#virtio-pci-device-plugged" id="id7">virtio_pci_device_plugged</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<img alt="../../_images/virtio-pci-virtio-bus.jpg" src="../../_images/virtio-pci-virtio-bus.jpg" />
<section id="create-virtio-bus">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Create Virtio-Bus</a><a class="headerlink" href="#create-virtio-bus" title="Permalink to this heading">¶</a></h2>
<p>virtio-bus创建是在 <a class="reference internal" href="0007.html#virtio-pci-realize"><span class="std std-ref">virtio_pci_realize</span></a> 函数中，在创建virtio_net_pci设备之前</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">virtio_pci_realize</span><span class="p">(</span><span class="n">PCIDevice</span><span class="w"> </span><span class="o">*</span><span class="n">pci_dev</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">**</span><span class="n">errp</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtIOPCIProxy</span><span class="w"> </span><span class="o">*</span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_PCI</span><span class="p">(</span><span class="n">pci_dev</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtioPCIClass</span><span class="w"> </span><span class="o">*</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_PCI_GET_CLASS</span><span class="p">(</span><span class="n">pci_dev</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>

<span class="w">    </span><span class="n">virtio_pci_bus_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">),</span><span class="w"> </span><span class="n">proxy</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>virtio_pci_realize 调用 <a class="reference internal" href="#virtio-pci-bus-new"><span class="std std-ref">virtio_pci_bus_new</span></a></p>
<div class="highlight-c notranslate" id="virtio-pci-bus-new"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">virtio_pci_bus_new</span><span class="p">(</span><span class="n">VirtioBusState</span><span class="w"> </span><span class="o">*</span><span class="n">bus</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bus_size</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="n">VirtIOPCIProxy</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DeviceState</span><span class="w"> </span><span class="o">*</span><span class="n">qdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEVICE</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">virtio_bus_name</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;virtio-bus&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">qbus_create_inplace</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span><span class="w"> </span><span class="n">bus_size</span><span class="p">,</span><span class="w"> </span><span class="n">TYPE_VIRTIO_PCI_BUS</span><span class="p">,</span><span class="w"> </span><span class="n">qdev</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">virtio_bus_name</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="a-virtiodevice-is-being-plugged">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">A VirtIODevice is being plugged</a><a class="headerlink" href="#a-virtiodevice-is-being-plugged" title="Permalink to this heading">¶</a></h2>
<p>virtio设备创建完成后，需要将此设备添加到virtio-bus中去，</p>
<p>refer to: <a class="reference internal" href="0008.html#virtio-device-realize"><span class="std std-ref">virtio_device_realize</span></a></p>
<section id="virtio-bus-device-plugged">
<span id="id1"></span><h3><a class="toc-backref" href="#id6" role="doc-backlink">virtio_bus_device_plugged</a><a class="headerlink" href="#virtio-bus-device-plugged" title="Permalink to this heading">¶</a></h3>
<p>virtio_bus_device_plugged主要调用了VirtioBusClass类型的device_plugged回调函数，</p>
<p>该回调函数在virtio_pci_bus_class_init被初始化成 <a class="reference internal" href="#virtio-pci-device-plugged"><span class="std std-ref">virtio_pci_device_plugged</span></a></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">virtio_bus_device_plugged</span><span class="p">(</span><span class="n">VirtIODevice</span><span class="w"> </span><span class="o">*</span><span class="n">vdev</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">**</span><span class="n">errp</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DeviceState</span><span class="w"> </span><span class="o">*</span><span class="n">qdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEVICE</span><span class="p">(</span><span class="n">vdev</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">BusState</span><span class="w"> </span><span class="o">*</span><span class="n">qbus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BUS</span><span class="p">(</span><span class="n">qdev_get_parent_bus</span><span class="p">(</span><span class="n">qdev</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtioBusState</span><span class="w"> </span><span class="o">*</span><span class="n">bus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_BUS</span><span class="p">(</span><span class="n">qbus</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtioBusClass</span><span class="w"> </span><span class="o">*</span><span class="n">klass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_BUS_GET_CLASS</span><span class="p">(</span><span class="n">bus</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtioDeviceClass</span><span class="w"> </span><span class="o">*</span><span class="n">vdc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_DEVICE_GET_CLASS</span><span class="p">(</span><span class="n">vdev</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">has_iommu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_host_has_feature</span><span class="p">(</span><span class="n">vdev</span><span class="p">,</span><span class="w"> </span><span class="n">VIRTIO_F_IOMMU_PLATFORM</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Error</span><span class="w"> </span><span class="o">*</span><span class="n">local_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">DPRINTF</span><span class="p">(</span><span class="s">&quot;%s: plug device.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">qbus</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">pre_plugged</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">pre_plugged</span><span class="p">(</span><span class="n">qbus</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">local_err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">error_propagate</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* Get the features of the plugged device. */</span><span class="w"></span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">vdc</span><span class="o">-&gt;</span><span class="n">get_features</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">host_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vdc</span><span class="o">-&gt;</span><span class="n">get_features</span><span class="p">(</span><span class="n">vdev</span><span class="p">,</span><span class="w"> </span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">host_features</span><span class="p">,</span><span class="w"></span>
<span class="w">                                            </span><span class="o">&amp;</span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">local_err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">error_propagate</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">device_plugged</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">device_plugged</span><span class="p">(</span><span class="n">qbus</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">local_err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">error_propagate</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="n">local_err</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">get_dma_as</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">has_iommu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">virtio_add_feature</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">host_features</span><span class="p">,</span><span class="w"> </span><span class="n">VIRTIO_F_IOMMU_PLATFORM</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">dma_as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">klass</span><span class="o">-&gt;</span><span class="n">get_dma_as</span><span class="p">(</span><span class="n">qbus</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">dma_as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">address_space_memory</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="virtio-pci-device-plugged">
<span id="id2"></span><h3><a class="toc-backref" href="#id7" role="doc-backlink">virtio_pci_device_plugged</a><a class="headerlink" href="#virtio-pci-device-plugged" title="Permalink to this heading">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* This is called by virtio-bus just after the device is plugged. */</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">virtio_pci_device_plugged</span><span class="p">(</span><span class="n">DeviceState</span><span class="w"> </span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">**</span><span class="n">errp</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtIOPCIProxy</span><span class="w"> </span><span class="o">*</span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_PCI</span><span class="p">(</span><span class="n">d</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtioBusState</span><span class="w"> </span><span class="o">*</span><span class="n">bus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">legacy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_pci_legacy</span><span class="p">(</span><span class="n">proxy</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">modern</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">modern_pio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">VIRTIO_PCI_FLAG_MODERN_PIO_NOTIFY</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">VirtIODevice</span><span class="w"> </span><span class="o">*</span><span class="n">vdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_bus_get_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * Virtio capabilities present without</span>
<span class="cm">     * VIRTIO_F_VERSION_1 confuses guests</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">ignore_backend_features</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span><span class="n">virtio_has_feature</span><span class="p">(</span><span class="n">vdev</span><span class="o">-&gt;</span><span class="n">host_features</span><span class="p">,</span><span class="w"> </span><span class="n">VIRTIO_F_VERSION_1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">virtio_pci_disable_modern</span><span class="p">(</span><span class="n">proxy</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">legacy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">error_setg</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Device doesn&#39;t support modern mode, and legacy&quot;</span><span class="w"></span>
<span class="w">                             </span><span class="s">&quot; mode is disabled&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">error_append_hint</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Set disable-legacy to off</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">modern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_pci_modern</span><span class="p">(</span><span class="n">proxy</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">.</span><span class="n">config</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">class_code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_config_set_class</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">class_code</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">legacy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">virtio_host_has_feature</span><span class="p">(</span><span class="n">vdev</span><span class="p">,</span><span class="w"> </span><span class="n">VIRTIO_F_IOMMU_PLATFORM</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">error_setg</span><span class="p">(</span><span class="n">errp</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;VIRTIO_F_IOMMU_PLATFORM was supported by&quot;</span><span class="w"></span>
<span class="w">                       </span><span class="s">&quot; neither legacy nor transitional device&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">         * Legacy and transitional devices use specific subsystem IDs.</span>
<span class="cm">         * Note that the subsystem vendor ID (config + PCI_SUBSYSTEM_VENDOR_ID)</span>
<span class="cm">         * is set to PCI_SUBVENDOR_ID_REDHAT_QUMRANET by default.</span>
<span class="cm">         */</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_word</span><span class="p">(</span><span class="n">config</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PCI_SUBSYSTEM_ID</span><span class="p">,</span><span class="w"> </span><span class="n">virtio_bus_get_vdev_id</span><span class="p">(</span><span class="n">bus</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* pure virtio-1.0 */</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_word</span><span class="p">(</span><span class="n">config</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PCI_VENDOR_ID</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="n">PCI_VENDOR_ID_REDHAT_QUMRANET</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_word</span><span class="p">(</span><span class="n">config</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PCI_DEVICE_ID</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="mh">0x1040</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">virtio_bus_get_vdev_id</span><span class="p">(</span><span class="n">bus</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_config_set_revision</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">config</span><span class="p">[</span><span class="n">PCI_INTERRUPT_PIN</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>


<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">modern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">virtio_pci_cap</span><span class="w"> </span><span class="n">cap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cap_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">cap</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">virtio_pci_notify_cap</span><span class="w"> </span><span class="n">notify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">cap_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">notify</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">notify_off_multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">                </span><span class="n">cpu_to_le32</span><span class="p">(</span><span class="n">virtio_pci_queue_mem_mult</span><span class="p">(</span><span class="n">proxy</span><span class="p">)),</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">virtio_pci_cfg_cap</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">cap_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">cfg</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">cfg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_PCI_CAP_PCI_CFG</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">virtio_pci_notify_cap</span><span class="w"> </span><span class="n">notify_pio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">cap_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">notify</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">.</span><span class="n">notify_off_multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cpu_to_le32</span><span class="p">(</span><span class="mh">0x0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">virtio_pci_cfg_cap</span><span class="w"> </span><span class="o">*</span><span class="n">cfg_mask</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">virtio_pci_modern_regions_init</span><span class="p">(</span><span class="n">proxy</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">virtio_pci_modern_mem_region_map</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">common</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">virtio_pci_modern_mem_region_map</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">isr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">virtio_pci_modern_mem_region_map</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">virtio_pci_modern_mem_region_map</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">notify</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">notify</span><span class="p">.</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">modern_pio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">memory_region_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">io_bar</span><span class="p">,</span><span class="w"> </span><span class="n">OBJECT</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span><span class="w"></span>
<span class="w">                               </span><span class="s">&quot;virtio-pci-io&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="n">pci_register_bar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">modern_io_bar_idx</span><span class="p">,</span><span class="w"></span>
<span class="w">                             </span><span class="n">PCI_BASE_ADDRESS_SPACE_IO</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">io_bar</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="n">virtio_pci_modern_io_region_map</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">notify_pio</span><span class="p">,</span><span class="w"></span>
<span class="w">                                            </span><span class="o">&amp;</span><span class="n">notify_pio</span><span class="p">.</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">pci_register_bar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">modern_mem_bar_idx</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">PCI_BASE_ADDRESS_SPACE_MEMORY</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">                         </span><span class="n">PCI_BASE_ADDRESS_MEM_PREFETCH</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="w">                         </span><span class="n">PCI_BASE_ADDRESS_MEM_TYPE_64</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">modern_bar</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">config_cap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_pci_add_mem_cap</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">.</span><span class="n">cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">cfg_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">.</span><span class="n">wmask</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">config_cap</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_byte</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg_mask</span><span class="o">-&gt;</span><span class="n">cap</span><span class="p">.</span><span class="n">bar</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="mh">0x0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_long</span><span class="p">((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cfg_mask</span><span class="o">-&gt;</span><span class="n">cap</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="mh">0x0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_long</span><span class="p">((</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cfg_mask</span><span class="o">-&gt;</span><span class="n">cap</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="mh">0x0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">pci_set_long</span><span class="p">(</span><span class="n">cfg_mask</span><span class="o">-&gt;</span><span class="n">pci_cfg_data</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="mh">0x0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">nvectors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msix_init_exclusive_bar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">nvectors</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">msix_bar_idx</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* Notice when a system that supports MSIx can&#39;t initialize it */</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="n">ENOTSUP</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">warn_report</span><span class="p">(</span><span class="s">&quot;unable to init msix vectors to %&quot;</span><span class="w"> </span><span class="n">PRIu32</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">nvectors</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">nvectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">.</span><span class="n">config_write</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_write_config</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">.</span><span class="n">config_read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">virtio_read_config</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">legacy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VIRTIO_PCI_REGION_SIZE</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">virtio_bus_get_vdev_config_len</span><span class="p">(</span><span class="n">bus</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2ceil</span><span class="p">(</span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">memory_region_init_io</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bar</span><span class="p">,</span><span class="w"> </span><span class="n">OBJECT</span><span class="p">(</span><span class="n">proxy</span><span class="p">),</span><span class="w"></span>
<span class="w">                              </span><span class="o">&amp;</span><span class="n">virtio_pci_config_ops</span><span class="p">,</span><span class="w"></span>
<span class="w">                              </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;virtio-pci&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">pci_register_bar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">pci_dev</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">legacy_io_bar_idx</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">PCI_BASE_ADDRESS_SPACE_IO</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">proxy</span><span class="o">-&gt;</span><span class="n">bar</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">GDocs</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../corp.html">Corporation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cmds/index.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Linux Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../binaryAnalysis.html">BinaryAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cplus/index.html">Cplus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../els/index.html">ESL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../andorid/index.html">Andorid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yocto/index.html">Yocto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emacs/index.html">Emacs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Virtulization</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../qemu/index.html">Qemu</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Virtio</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0001-pre.html">Virtio devices and drivers overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="0001.html">Introduction to virtio-networking and vhost-net</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002.html">Deep dive into Virtio-networking and vhost-net</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003.html">How vhost-user came into being: Virtio-networking and DPDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004.html">A journey to the vhost-users realm</a></li>
<li class="toctree-l3"><a class="reference internal" href="0005.html">Introduction to VirtIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006.html">Qemu: Virtio-net Envrionment</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007.html">Qemu: Virtio_net_pci</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Qemu: Virtio_bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008.html">Qemu: Virtio_net Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="vhost-user.html">Vhost-user Protocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../00001.html">Install Ret Hat 7 server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00002.html">Qemu ifup script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00003.html">Random Mac address</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00004.html">Assign tap to VM Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00005.html">Open vSwitch with Libvirt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00006.html">EAL: No free hugepages reported in hugepages-2048kB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00007.html">Failed to connect socket /var/run/openvswitch/centos1_eth0: Permission denied</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00008.html">Establish OVP reference envrionment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00009.html">libvirt: Specify the kernel and rootfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00010.html">WRLinux with wayland and weston</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00011.html">Enable the support console for VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00012.html">Start Qemu with monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00013.html">Creating images from ISO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00014.html">Create image from Wrlinux image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../debian/index.html">Debian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licence/index.html">OpenSource License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Virtulization</a><ul>
  <li><a href="index.html">Virtio</a><ul>
      <li>Previous: <a href="0007.html" title="previous chapter">Qemu: Virtio_net_pci</a></li>
      <li>Next: <a href="0008.html" title="next chapter">Qemu: Virtio_net Device</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Haitao Lau.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/virt/virtio/0009.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>